(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{9811:function(e,t,n){Promise.resolve().then(n.bind(n,8483))},5025:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(3827);function s(e){let{onClick:t}=e;return(0,a.jsx)("button",{onClick:t,className:"p-2 rounded-full bg-pink-600 hover:bg-pink-500 text-white shadow-lg shadow-pink-500/40",title:"Send a gift",children:"\uD83C\uDF81"})}},1400:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var a=n(3827),s=n(4090);let r={roses:"bg-rose-500",explosion:"bg-black",car:"bg-slate-900"};function i(e){let{activeGift:t,onEnd:n}=e,[i,l]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{t&&l(!0)},[t]),!t||!i)return null;let c=r[t.background]||"bg-black";return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center ".concat(c," bg-opacity-90"),children:[(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:["roses"===t.background&&(0,a.jsx)("div",{className:"w-full h-full animate-pulse opacity-60"}),"explosion"===t.background&&(0,a.jsx)("div",{className:"w-full h-full animate-[ping_1.5s_ease-out_infinite] bg-gradient-to-br from-orange-500 via-yellow-400 to-red-700 opacity-60"}),"car"===t.background&&(0,a.jsx)("div",{className:"w-full h-full bg-gradient-to-r from-slate-900 via-slate-700 to-slate-900 opacity-70"})]}),(0,a.jsx)("video",{src:t.videoUrl,autoPlay:!0,playsInline:!0,className:"relative z-10 max-w-[80vw] max-h-[80vh] rounded-2xl shadow-2xl border border-white/20",onEnded:()=>{l(!1),n&&n()},onError:()=>{l(!1),n&&n()}}),(0,a.jsxs)("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 z-20 text-center text-white",children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-[0.3em] opacity-70",children:"Gift Received"}),(0,a.jsx)("div",{className:"text-2xl font-semibold mt-1",children:t.title})]})]})}},7998:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(3827),s=n(4090);function r(e){let{isOpen:t,onClose:n,onSendGift:r}=e,[i,l]=(0,s.useState)([]),[c,o]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{t&&(o(!0),fetch("/api/gifts").then(e=>e.json()).then(e=>l(e)).finally(()=>o(!1)))},[t]),t)?(0,a.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70",children:(0,a.jsxs)("div",{className:"bg-zinc-950 border border-zinc-800 rounded-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-zinc-800",children:[(0,a.jsx)("div",{className:"text-sm uppercase tracking-[0.3em] text-zinc-400",children:"Choose a Gift"}),(0,a.jsx)("button",{onClick:n,className:"text-zinc-400 hover:text-white text-xs",children:"Close"})]}),(0,a.jsxs)("div",{className:"p-4 overflow-y-auto",children:[c&&(0,a.jsx)("div",{className:"text-zinc-500 text-sm",children:"Loading gifts…"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:i.map(e=>(0,a.jsxs)("button",{onClick:()=>r(e),className:"group relative bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden hover:border-zinc-500 transition",children:[(0,a.jsx)("div",{className:"aspect-video bg-black",children:(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center text-xs text-zinc-500",children:e.title})}),(0,a.jsxs)("div",{className:"p-3 text-left",children:[(0,a.jsx)("div",{className:"text-sm text-white font-medium truncate",children:e.title}),(0,a.jsxs)("div",{className:"text-xs text-zinc-400 mt-1",children:[e.tier," • ",e.price," credits"]})]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition"})]},e.id))})]})]})}):null}},8483:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var a=n(3827),s=n(4090),r=n(3019),i=n(6142),l=n(9079),c=n(5025),o=n(7998),d=n(1400);let u={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]},{urls:["stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302"]},{urls:["turn:turnserver.twilio.com:3478?transport=udp","turn:turnserver.twilio.com:3479?transport=tcp"],username:"webrtc",credential:"webrtcpassword"}],iceCandidatePoolSize:20};function x(){let[e,t]=(0,s.useState)(null),[n,x]=(0,s.useState)(null),f=(0,s.useMemo)(()=>window.__app_id?window.__app_id:l.env.NEXT_PUBLIC_APP_ID||null,[]),h=(0,s.useMemo)(()=>f?["artifacts",f,"public","data","calls"]:["calls"],[f]),[m,g]=(0,s.useState)("Idle"),[p,v]=(0,s.useState)(null),[b,w]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),[y,C]=(0,s.useState)(!1),[_,E]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1),[I,R]=(0,s.useState)(null),[T,D]=(0,s.useState)(null),P=(0,s.useRef)(null),z=(0,s.useRef)(null),A=(0,s.useRef)(null),B=(0,s.useRef)(null),F=(0,s.useRef)([]),U=(0,s.useRef)(null),O=(0,s.useRef)(null);(0,s.useEffect)(()=>{try{t((0,r.ad)(function(){let e=function(){if(window.__firebase_config)return window.__firebase_config;let e={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID};if(!e.projectId)throw Error("Missing Firebase config. Provide NEXT_PUBLIC_FIREBASE_* env vars or window.__firebase_config.");return e}();return(0,i.C6)().length?(0,i.Mq)():(0,i.ZF)(e)}()))}catch(e){console.error(e),x(e.message)}},[]);let G=()=>{U.current&&(U.current(),U.current=null),O.current&&(O.current(),O.current=null)},J=()=>{null==I||I.getTracks().forEach(e=>e.stop()),null==T||T.getTracks().forEach(e=>e.stop()),R(null),D(null)},L=()=>{var e,t,n,a,s,r;G(),F.current=[],S(!1),null===(t=B.current)||void 0===t||null===(e=t.close)||void 0===e||e.call(t),B.current=null,null===(a=A.current)||void 0===a||null===(n=a.getSenders)||void 0===n||n.call(a).forEach(e=>{var t,n;return null===(n=e.track)||void 0===n?void 0:null===(t=n.stop)||void 0===t?void 0:t.call(n)}),null===(r=A.current)||void 0===r||null===(s=r.close)||void 0===s||s.call(r),A.current=null,J(),P.current&&(P.current.srcObject=null),z.current&&(z.current.srcObject=null),w(""),N(""),E(null),g("Call ended")};(0,s.useEffect)(()=>()=>{L()},[]);let M=e=>{B.current=e,S("open"===e.readyState),e.onopen=()=>S(!0),e.onclose=()=>S(!1)},X=async()=>{v(null),g("Requesting camera/microphone...");let e=new RTCPeerConnection(u);A.current=e;let t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});R(t),P.current&&(P.current.srcObject=t),t.getTracks().forEach(n=>e.addTrack(n,t));let n=new MediaStream;return D(n),z.current&&(z.current.srcObject=n),e.ontrack=e=>{e.streams&&e.streams[0]&&e.streams[0].getTracks().forEach(e=>{n.getTracks().find(t=>t.id===e.id)||n.addTrack(e)})},!function(e,t){let{onGiftReceived:n,onChannelReady:a}=t;e.ondatachannel=e=>{if("gifts"===e.channel.label){let t=e.channel;a&&a(t),t.onmessage=e=>{try{let t=JSON.parse(e.data);"GIFT"===t.type&&(null==n||n(t))}catch(e){console.error("Invalid gift message",e)}}}}}(e,{onGiftReceived:e=>E(e),onChannelReady:M}),e.onconnectionstatechange=()=>g("Connection state: ".concat(e.connectionState)),e.oniceconnectionstatechange=()=>console.log("ICE state ->",e.iceConnectionState),e.onicegatheringstatechange=()=>console.log("ICE gathering ->",e.iceGatheringState),e},Z=async(e,t)=>{if(t){if(e.currentRemoteDescription)try{await e.addIceCandidate(new RTCIceCandidate(t))}catch(e){console.error("Error adding remote ICE candidate",e)}else F.current.push(t)}},q=async e=>{if(0!==F.current.length){for(let t of F.current)try{await e.addIceCandidate(new RTCIceCandidate(t))}catch(e){console.error("Error flushing queued ICE candidate",e)}F.current=[]}},K=(0,s.useMemo)(()=>e?(0,r.hJ)(e,...h):null,[e,h]),H=async()=>{try{if(!K){v("Firebase is not ready. Check your config.");return}L(),g("Creating call...");let e=await X();!function(e,t){let n=e.createDataChannel("gifts");t&&(n.onopen=()=>t(n))}(e,M);let t=(0,r.JU)(K),n=(0,r.hJ)(t,"offerCandidates"),a=(0,r.hJ)(t,"answerCandidates");e.onicecandidate=async e=>{e.candidate&&await (0,r.ET)(n,e.candidate.toJSON())};let s=await e.createOffer();await e.setLocalDescription(s),await (0,r.pl)(t,{offer:{type:s.type,sdp:s.sdp},createdAt:(0,r.Bt)(),role:"caller"}),U.current=(0,r.cf)(t,async t=>{let n=t.data();if(!e.currentRemoteDescription&&(null==n?void 0:n.answer)){let t=new RTCSessionDescription(n.answer);await e.setRemoteDescription(t),await q(e),g("Answer received. Connecting...")}}),O.current=(0,r.cf)(a,t=>{t.docChanges().forEach(t=>{"added"===t.type&&Z(e,t.doc.data())})}),w(t.id),g("Call created. Share this ID: ".concat(t.id))}catch(e){console.error(e),v(e.message),g("Failed to start call"),L()}},W=async()=>{try{if(!j.trim()){v("Enter a Call ID to answer.");return}if(!e){v("Firebase is not ready. Check your config.");return}L(),g("Joining call...");let t=await X(),n=(0,r.JU)(e,...h,j.trim()),a=(await (0,r.QT)(n)).data();if(!(null==a?void 0:a.offer))throw Error("Offer not found for this Call ID.");let s=new RTCSessionDescription(a.offer);await t.setRemoteDescription(s),await q(t);let i=await t.createAnswer();await t.setLocalDescription(i);let l=(0,r.hJ)(n,"answerCandidates"),c=(0,r.hJ)(n,"offerCandidates");t.onicecandidate=async e=>{e.candidate&&await (0,r.ET)(l,e.candidate.toJSON())},await (0,r.r7)(n,{answer:{type:i.type,sdp:i.sdp},answeredAt:(0,r.Bt)(),role:"answerer"}),O.current=(0,r.cf)(c,e=>{e.docChanges().forEach(e=>{"added"===e.type&&Z(t,e.doc.data())})}),w(j.trim()),g("Answer sent. Waiting for connection...")}catch(e){console.error(e),v(e.message),g("Failed to answer call"),L()}},Y=async e=>{var t;if(!B.current||"open"!==B.current.readyState){g("Gift channel is not ready yet—wait for the call to connect.");return}await fetch("/api/send-gift",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({giftId:e.id,toUserId:"demo-recipient"})}),(t=B.current)&&"open"===t.readyState&&t.send(JSON.stringify({type:"GIFT",videoUrl:e.videoUrl,background:e.background,title:e.title})),E(e),C(!1)};return n?(0,a.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Firebase config missing"}),(0,a.jsx)("div",{className:"text-sm text-zinc-400",children:n}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"Provide NEXT_PUBLIC_FIREBASE_* env vars or window.__firebase_config."})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-black via-slate-950 to-black text-white",children:[(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-6 py-10 space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-zinc-500",children:"Antonio Records • Live Gifting"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold",children:"Peer-to-Peer Stage with Virtual Gifts"}),(0,a.jsx)("p",{className:"text-sm text-zinc-400",children:"Start a call, drop a Call ID to a friend, and let fans fire off cinematic gifts over the WebRTC data channel."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-[1.15fr_0.85fr] gap-6 items-start",children:[(0,a.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 shadow-2xl shadow-pink-500/10",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("video",{ref:P,autoPlay:!0,muted:!0,playsInline:!0,className:"rounded-xl border border-pink-400/70 w-80 h-60 bg-black"}),(0,a.jsx)("div",{className:"text-center text-xs mt-2 text-zinc-400",children:"You"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("video",{ref:z,autoPlay:!0,playsInline:!0,className:"rounded-xl border border-cyan-400/70 w-80 h-60 bg-black"}),(0,a.jsx)("div",{className:"text-center text-xs mt-2 text-zinc-400",children:"Remote"})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-3",children:[(0,a.jsx)(c.Z,{onClick:()=>C(!0)}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:k?"Gift channel ready":"Gifts unlock once the call connects"})]})]}),(0,a.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium mb-1",children:"Create a new call"}),(0,a.jsx)("button",{onClick:H,className:"w-full bg-pink-600 hover:bg-pink-500 text-white py-2 px-3 rounded-lg text-sm font-semibold",children:"Start Call & Share ID"}),b&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-green-400 break-all",children:["Call ID: ",(0,a.jsx)("span",{className:"font-mono",children:b})]})]}),(0,a.jsxs)("div",{className:"border-t border-white/5 pt-3",children:[(0,a.jsx)("div",{className:"text-sm font-medium mb-1",children:"Join existing call"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{value:j,onChange:e=>N(e.target.value),placeholder:"Enter Call ID",className:"flex-1 rounded-lg bg-black/40 border border-white/10 px-3 py-2 text-sm focus:outline-none focus:border-pink-500"}),(0,a.jsx)("button",{onClick:W,className:"bg-cyan-600 hover:bg-cyan-500 text-white px-3 py-2 rounded-lg text-sm font-semibold",children:"Answer"})]})]}),(0,a.jsx)("div",{className:"border-t border-white/5 pt-3 flex gap-2",children:(0,a.jsx)("button",{onClick:L,className:"bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm",children:"Hang Up"})}),(0,a.jsxs)("div",{className:"border-t border-white/5 pt-3 space-y-1",children:[(0,a.jsx)("div",{className:"text-xs text-zinc-400",children:"Status"}),(0,a.jsx)("div",{className:"text-sm text-white",children:m}),p&&(0,a.jsx)("div",{className:"text-xs text-red-400",children:p})]})]})]})]}),(0,a.jsx)(o.Z,{isOpen:y,onClose:()=>C(!1),onSendGift:Y}),(0,a.jsx)(d.Z,{activeGift:_,onEnd:()=>E(null)})]}):(0,a.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-sm text-zinc-400",children:"Loading Firebase…"})})}}},function(e){e.O(0,[287,330,971,69,744],function(){return e(e.s=9811)}),_N_E=e.O()}]);